# ====== R Scipt for take home exercise solution === 
# Hi friend
# Nhiem vu 1: Nhap du lieu
covid_cases <- readRDS("day1/data/covid_cases.rds")

# Nhiem vu 2: Tính toán đơn giản
library(janitor)
library(tidyverse)
library(skimr)
library(readxl)
library(haven)
library(lubridate)
library(dplyr)


covid_cases <- tibble(covid_cases)

first_report_date <- min(covid_cases$date, na.rm = TRUE)
  
last_report_date <- max(covid_cases$date, na.rm = TRUE)

covid_cases <- covid_cases %>% 
  mutate(across(2:ncol(covid_cases), as.numeric))

str(covid_cases)

covid_cases$case_global <- rowSums(covid_cases[,-1])

covid_cases[["percent_chn"]] <- (covid_cases$cases_chn/covid_cases$case_global)*100


##Nhiệm vụ 3: Tạo một function

compute_percent <- function(x, data){
  cases_name <- paste("cases_", x, sep = "")
  percent_name <- paste("percent_", x, sep = "")
  data[[percent_name]] <- (data[[cases_name]]/data[["case_global"]])*100
  return(data[[percent_name]])
}

covid_cases[["percent_vnm"]] <- compute_percent("vnm", covid_cases)
covid_cases[["percent_usa"]] <- compute_percent("usa", covid_cases)
covid_cases[["percent_sgp"]] <- compute_percent("sgp", covid_cases)

print(covid_cases[, c("date", "percent_chn", "percent_vnm", "percent_usa", "percent_sgp")])

##Nhiệm vụ 3.5: 
covid_cases <- covid_cases %>%  mutate_if(is.Date, ymd) 

library(ggplot2)

#nhap vao function phai co dau ""
plot_function <- function(col, country){
  plot_col <- col
  country_plot <- country
  
  ggplot() +
    geom_col( 
      aes( 
        x = covid_cases$date, 
        y = covid_cases[[plot_col]] 
      ), 
      fill = "cornflowerblue" 
    ) +
    geom_line( 
      aes( 
        x = covid_cases$date, 
        y = covid_cases[[plot_col]] 
      ), 
      color = "red" 
    ) +
    labs(
      y = "Cases",
      x = "Date",
      title = paste0("Reported Covid cases for ", country_plot) 
    )
}

#Nhiệm vụ 4:

skimr::skim(covid_cases[,c("cases_chn","cases_vnm","cases_sgp","cases_usa")])

#4 cột số liệu theo dõi số ca COVID-19 tại Trung Quốc (cases_chn), Việt Nam (cases_vnm), Singapore (cases_sgp) và Hoa Kỳ (cases_usa). Số ca phân bố lệch phải, với giá trị trung bình lần lượt là 913, 2.91, 87.1 và 8,166, không có giá trị thiếu. Hoa Kỳ có số ca cao nhất (tối đa 35,386), trong khi Việt Nam thấp nhất (tối đa 19).

#Nhiệm vụ 5: Push lên github
